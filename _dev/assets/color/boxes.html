<!DOCTYPE html>
<html>
<head>
  <title></title>
  <style type="text/css">
    .group {float: left; margin: 20px;}
    .box {display: inline-block; width: 20px;height: 20px;margin: 2px;border: 3px solid black}
  </style>
</head>
<body>
  <script src="context_blender.js"></script>

  <div id="root"></div>

  <script type="text/javascript">
    function getcol(sch, p) {
      if (typeof p === 'undefined')
        var p = Math.random();

      return p*(sch[1]-sch[0]) + sch[0];
    }

    function Blender(algorithm, precision) {
      this.algorithm = algorithm;
      this.precision = precision;

      this.process = function(base, adj) {
        var self = this;
        if (this.precision == 'subpixel') {
          // do a different thing for each subpixel
        } else {
          return [this.algorithm(base[0], adj[0]), this.algorithm(base[1], adj[1]), this.algorithm(base[2], adj[2])];
        }
      }
    }

    var blend = {
      none: new Blender(function(base, adj) { return base; }),
      normal: new Blender(function(base, adj) { return adj; }),
      // 
      darken: new Blender(function(base, adj) { return Math.min(base, adj); }),
      multiply: new Blender(function(base, adj) { return ((base * adj) / 255); }),
      colorburn: new Blender(function(base, adj) { return adj <= 0 ? 0 : Math.max(255 - ((255 - base) * 255 / adj), 0); }),
      linearburn: new Blender(function(base, adj) { return Math.max(0, (base + adj - 255)); }),
      // 
      lighten: new Blender(function(base, adj) { return Math.max(base, adj); }),
      screen: new Blender(function(base, adj) { return (255 - (((255 - base) * (255 - adj)) / 255)); }),
      colordodge: new Blender(function(base, adj) { return adj >= 255 ? 255 : Math.min(base * 255 / (255 - adj), 255); }),
      lineardodge: new Blender(function(base, adj) { return Math.min((base + adj), 255); }),
      // 
      overlay: new Blender(function(base, adj) { return (base < 128) ? ((2 * base * adj) / 255) : (255 - (2 * (255 - base) * (255 - adj) / 255)); }),
      softlight: new Blender(function(base, adj) { return (base < 128) ? (((adj>>1) + 64) * base * (2/255)) : (255 - (191 - (adj>>1)) * (255 - base) * (2 / 255)); }),
      hardlight: new Blender(function(base, adj) { return adj < 128 ? (2 * base * adj) / 255 : 255 - ((2 * (255 - base) * (255 - adj)) / 255); }),
      //
      difference: new Blender(function(base, adj) { return Math.abs(base - adj); }),
      exclusion: new Blender(function(base, adj) { return 255 - (((255 - base) * (255 - adj) / 255) + (base * adj / 255)); }),
      subtract: new Blender(function(base, adj) { return Math.max((base - adj), 0); })
    };

    var qq = {
      r: [190, 215],
      g: [185, 196],
      b: [130, 184],
    };

    var colors = [
      [215,215,0],
      [255,50,50],
      [145,30,180],
      [149,37,87],
      [164,20,90],

    ];

    var str = '';
    var def = [211,191,158];

    for (var bl in blend) {
        str += bl;
      str += '<br/>';

      for (var col of colors) {
        var b = blend[bl].process(def, col);
        //var b = blend[bl].process(col, def);
        str += '<div class="box" style="border-color:rgb('+col[0]+','+col[1]+','+col[2]+'); background:rgb('+b[0]+','+b[1]+','+b[2]+')"></div>';
      }

      str += '<br/>';

      for (var col of colors) {
        var b = blend[bl].process(col, def);
        //var b = blend[bl].process(col, def);
        str += '<div class="box" style="border-color:rgb('+col[0]+','+col[1]+','+col[2]+'); background:rgb('+b[0]+','+b[1]+','+b[2]+')"></div>';
      }

      str += '<br/>';
    }


    var elem = document.getElementById('root');
    elem.innerHTML = str;

    /*
    211,191,158

    203,190,174
    214,186,162
    191,195,181
    199,185,184
    198,193,151
    215,196,130
    */
  </script>
</body>
</html>