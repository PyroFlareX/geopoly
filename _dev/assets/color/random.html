<!DOCTYPE html>
<html>
<head>
  <title></title>
  <style type="text/css">
    .group {float: left; margin: 20px;}
    .box {display: inline-block; width: 20px;height: 20px;margin: 2px;border: 3px solid black}
  </style>
</head>
<body>
  <script src="context_blender.js"></script>

  <div id="root"></div>

  <script type="text/javascript">
    function getcol(sch, p) {
      if (typeof p === 'undefined')
        var p = Math.random();

      return p*(sch[1]-sch[0]) + sch[0];
    }

    function Blender(algorithm, precision) {
      this.algorithm = algorithm;
      this.precision = precision;

      this.process = function(base, adj) {
        var self = this;
        if (this.precision == 'subpixel') {
          // do a different thing for each subpixel
        } else {
          return [this.algorithm(base[0], adj[0]), this.algorithm(base[1], adj[1]), this.algorithm(base[2], adj[2])];
        }
      }
    }

    var blend = {
      none: new Blender(function(base, adj) { return base; }),
      normal: new Blender(function(base, adj) { return adj; }),
      // 
      darken: new Blender(function(base, adj) { return Math.min(base, adj); }),
      multiply: new Blender(function(base, adj) { return ((base * adj) / 255); }),
      colorburn: new Blender(function(base, adj) { return adj <= 0 ? 0 : Math.max(255 - ((255 - base) * 255 / adj), 0); }),
      linearburn: new Blender(function(base, adj) { return Math.max(0, (base + adj - 255)); }),
      // 
      lighten: new Blender(function(base, adj) { return Math.max(base, adj); }),
      screen: new Blender(function(base, adj) { return (255 - (((255 - base) * (255 - adj)) / 255)); }),
      colordodge: new Blender(function(base, adj) { return adj >= 255 ? 255 : Math.min(base * 255 / (255 - adj), 255); }),
      lineardodge: new Blender(function(base, adj) { return Math.min((base + adj), 255); }),
      // 
      overlay: new Blender(function(base, adj) { return (base < 128) ? ((2 * base * adj) / 255) : (255 - (2 * (255 - base) * (255 - adj) / 255)); }),
      softlight: new Blender(function(base, adj) { return (base < 128) ? (((adj>>1) + 64) * base * (2/255)) : (255 - (191 - (adj>>1)) * (255 - base) * (2 / 255)); }),
      hardlight: new Blender(function(base, adj) { return adj < 128 ? (2 * base * adj) / 255 : 255 - ((2 * (255 - base) * (255 - adj)) / 255); }),
      //
      difference: new Blender(function(base, adj) { return Math.abs(base - adj); }),
      exclusion: new Blender(function(base, adj) { return 255 - (((255 - base) * (255 - adj) / 255) + (base * adj / 255)); }),
      subtract: new Blender(function(base, adj) { return Math.max((base - adj), 0); })
    };

    var str = '';
    var base = [211,191,158];

    for (var i=0;i<20;i++) {
      color = [
        Math.round(Math.random()*255),
        Math.round(Math.random()*255),
        Math.round(Math.random()*255),
      ];

      var bg5 = blend.lineardodge.process(base, color);
      var bg4 = blend.screen.process(base, color);
      var bg3 = blend.softlight.process(base, color);
      var bg2 = blend.hardlight.process(color, base);
      var bg1 = blend.darken.process(base, color);

      str += '<div class="box" style="border-color:rgb('+color[0]+','+color[1]+','+color[2]+'); background:rgb('+bg1[0]+','+bg1[1]+','+bg1[2]+')"></div>';
      str += '<div class="box" style="border-color:rgb('+color[0]+','+color[1]+','+color[2]+'); background:rgb('+bg2[0]+','+bg2[1]+','+bg2[2]+')"></div>';
      str += '<div class="box" style="border-color:rgb('+color[0]+','+color[1]+','+color[2]+'); background:rgb('+bg3[0]+','+bg3[1]+','+bg3[2]+')"></div>';
      str += '<div class="box" style="border-color:rgb('+color[0]+','+color[1]+','+color[2]+'); background:rgb('+bg4[0]+','+bg4[1]+','+bg4[2]+')"></div>';
      str += '<div class="box" style="border-color:rgb('+color[0]+','+color[1]+','+color[2]+'); background:rgb('+bg5[0]+','+bg5[1]+','+bg5[2]+')"></div>';

      str += '['+color[0]+','+color[1]+','+color[2]+']';

      str += '<br/>';
    }


    var elem = document.getElementById('root');
    elem.innerHTML = str;

  </script>
</body>
</html>