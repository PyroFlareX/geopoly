<!DOCTYPE html>
<html>
<head>
  <title></title>
  <style type="text/css">
    .group {float: left; margin: 20px;}
    .box {display: inline-block; width: 20px;height: 20px;margin: 2px;border: 3px solid black}
  </style>
</head>
<body>
  <script src="context_blender.js"></script>

  <div id="root"></div>

  <script type="text/javascript">
    function shuffle(a) {
        var j, x, i;
        for (i = a.length - 1; i > 0; i--) {
            j = Math.floor(Math.random() * (i + 1));
            x = a[i];
            a[i] = a[j];
            a[j] = x;
        }
        return a;
    }

    function Blender(algorithm, precision) {
      this.algorithm = algorithm;
      this.precision = precision;

      this.process = function(base, adj) {
        var self = this;
        if (this.precision == 'subpixel') {
          // do a different thing for each subpixel
        } else {
          return [this.algorithm(base[0], adj[0]), this.algorithm(base[1], adj[1]), this.algorithm(base[2], adj[2])];
        }
      }
    }

    var blend = {
      none: new Blender(function(base, adj) { return base; }),
      normal: new Blender(function(base, adj) { return adj; }),
      // 
      darken: new Blender(function(base, adj) { return Math.min(base, adj); }),
      multiply: new Blender(function(base, adj) { return ((base * adj) / 255); }),
      colorburn: new Blender(function(base, adj) { return adj <= 0 ? 0 : Math.max(255 - ((255 - base) * 255 / adj), 0); }),
      linearburn: new Blender(function(base, adj) { return Math.max(0, (base + adj - 255)); }),
      // 
      lighten: new Blender(function(base, adj) { return Math.max(base, adj); }),
      screen: new Blender(function(base, adj) { return (255 - (((255 - base) * (255 - adj)) / 255)); }),
      colordodge: new Blender(function(base, adj) { return adj >= 255 ? 255 : Math.min(base * 255 / (255 - adj), 255); }),
      lineardodge: new Blender(function(base, adj) { return Math.min((base + adj), 255); }),
      // 
      overlay: new Blender(function(base, adj) { return (base < 128) ? ((2 * base * adj) / 255) : (255 - (2 * (255 - base) * (255 - adj) / 255)); }),
      softlight: new Blender(function(base, adj) { return (base < 128) ? (((adj>>1) + 64) * base * (2/255)) : (255 - (191 - (adj>>1)) * (255 - base) * (2 / 255)); }),
      hardlight: new Blender(function(base, adj) { return adj < 128 ? (2 * base * adj) / 255 : 255 - ((2 * (255 - base) * (255 - adj)) / 255); }),
      //
      difference: new Blender(function(base, adj) { return Math.abs(base - adj); }),
      exclusion: new Blender(function(base, adj) { return 255 - (((255 - base) * (255 - adj) / 255) + (base * adj / 255)); }),
      subtract: new Blender(function(base, adj) { return Math.max((base - adj), 0); })
    };

    var str = '';
    var base = [211,191,158];

    var colors = [
      [250,190,190],
      [116,145,68],
      [27,6,100],
      [146,68,97],
      [252,32,81],
      [176,145,243],
      [56,55,48],
      [235,251,206],
      [57,82,114],
      [24,107,39],
      [207, 20, 43],
      [252,32,29],
      [158,11,33],
      [233,47,20],
      [200,0,0],
      [230,29,24],
      [232,43,54],
      [240,52,100],
      [128, 0, 0],
      [176,14,48],
      [243,67,38],
      [194,24,40],
      [165,0,33],
      [3,7,147],
      [0,18,212],
      [0,0,128],
      [17,2,233],
      [22,55,137],
      [0,40,104],
      [19,56,176],
      [60, 180, 75],
      [63,120,35],
      [0, 77, 0],
      [0, 153, 0],
      [68,180,61],
      [0,108,53],
      [7,109,74],
      [250,127,4],
      [89,198,97],
      [65,85,38],
      [245, 130, 48],
      [215,67,32],
      [242,7,8],
      [253,73,29],
      [225,130,75],
      [250,106,43],
      [128,78,56],
      [232, 200, 148],
      [80,18,27],
      [116, 172, 223],
      [0, 147, 221],
      [4, 113, 232],
      [0,81,151],
      [0,128,128],
      [0,161,242],
      [60, 77, 75],
      [180, 180, 180],
      [128, 128, 128],
      [81,104,92],
      [53,91,87],
      [128, 128, 0],
      [254, 205, 33],
      [170, 110, 40],
      [255,221,0],
      [255,254,22],
      [215, 215, 0],
      [255,50,50],
      [145, 30, 180],
      [149,37,87],
      [164,20,90],
      [91,81,161],
      [230,190,255],
      [80,18,27],
      [150, 50, 209],
      [254,1,88],
      [140,0,140],
      [255,0,255],

    ];

    shuffle(colors);

    for (var color of colors) {
      var bg5 = blend.lineardodge.process(base, color);
      var bg4 = blend.screen.process(base, color);
      var bg3 = blend.softlight.process(base, color);
      var bg2 = blend.hardlight.process(color, base);
      var bg1 = blend.darken.process(base, color);


      str += '<div class="box" style="border-color:rgb('+color[0]+','+color[1]+','+color[2]+'); background:rgb('+bg3[0]+','+bg3[1]+','+bg3[2]+')">'+''+'</div>';
    }


    var elem = document.getElementById('root');
    elem.innerHTML = str;

  </script>
</body>
</html>