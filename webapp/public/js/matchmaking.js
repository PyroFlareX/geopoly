!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.geopoly=t():e.geopoly=t()}(this,(function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(o,s,function(t){return e[t]}.bind(null,s));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));const o=new function(){this.groups={},this.model={},this.subscribed={},this.reoccuring={},this.onconnected_func=[],this.ondisconnected_func=[],this.onerror_func=[],this.ws=null,this.log_style="color: purple",this.address=null,this.c_msid=1,this.trying=!1,this.request=function(e,t){if(1!=this.ws.readyState)return console.error("WebSocket is not connected"),{then:()=>{}};if(t||"string"==typeof e)t||(t={}),t.route=e;else t=e;t.route||console.error("No route defined for request: ",t),t.msid=this.c_msid++,console.log(`%c<${e} (${t.msid})`,o.log_style,t);var n=JSON.stringify(t);return this.ws.send(n),new s(e,t.msid)},this.onconnect=function(e){this.onconnected_func.push(e)},this.ondisconnect=function(e){this.ondisconnected_func.push(e)},this.onerror=function(e){this.onerror_func.push(e)},this.onmessage=function(e){if(null!=e.data)var t=JSON.parse(e.data);else t=e;try{var n=t.route.split(":"),s=o.groups[n[0]]||this;console.log("%c>"+t.route+`(${t.msid||"0"})`,"color:purple",t);try{delete(r=Object.assign({},t)).route}catch(e){var r=t}r.params&&(r=r.params),t.msid&&o.subscribed[t.msid]?(o.subscribed[t.msid].apply(s,[r]),delete o.subscribed[t.msid]):o.subscribed[t.route]&&(o.subscribed[t.route].apply(s,[r]),delete o.subscribed[t.route]),o.reoccuring[t.route]&&o.reoccuring[t.route].apply(s,[r]);var c=s[n[1]];c&&c.apply(s,[r])}catch(e){console.error(e)}},this.on=function(e,t){this.reoccuring[e]=t},this.connect=function(e,t){this.address=e;try{this.ws=new WebSocket(e)}catch(e){for(let e of o.ondisconnected_func)e();return}this.ws.onopen=function(e){console.log("%cConnected to websocket",o.log_style);for(let e of o.onconnected_func)e();t()},this.ws.onerror=function(e){if(1==this.ws.readyState)for(let e of o.onerror_func)e();else{console.log("%cError with connecting to websocket",o.log_style),o.trying=!1;for(let e of o.ondisconnected_func)e()}},this.ws.onclose=function(e){console.log("%cDisconnected from websocket",o.log_style),o.trying=!1;for(let e of o.ondisconnected_func)e()},this.ws.onmessage=this.onmessage},this.reconnect=function(e){o.trying||o.tryReconnect(1,e)},this.tryReconnect=function(e,t,n,s){if(null==e)e=1;0!=e?o.ws.readyState!==o.ws.OPEN&&(o.trying||(o.trying=!0,console.log("%cTrying to reconnect..",o.log_style),null!=s&&s(),o.connect(o.address,(function(){o.trying=!1,console.log("%cReconnect successful",o.log_style),null!=t&&t()}))),setTimeout(()=>{o.tryReconnect(e--)},4e3)):null!=n&&n()}};var s=function(e,t){this.then=function(e){o.subscribed[t]=e}};let r=o},function(e,t,n){"use strict";var o=n(0),s=n(2);let r=o.a;function c(e,t){const n={route:e,params:t};switch(e){case"Game:move":n.params.events={conquer:!1,kill:!1},r.onmessage(n);break;case"Game:buy":let o=s.b[t.item_id];n.params.cost={gold:o.cost_gold,pop:o.cost_pop},r.onmessage(n);break;default:console.info(e,"called with",t)}}n.d(t,"a",(function(){return i}));const i={controllers:{},groups:{},ws:o.a,init_game_client:function(e,t,n){this.conf=e,e.websocket?(this.ws.groups=this.groups,this.ws.connect(e.ws_address,()=>{this.request_auth(t,n)}),this.ws.onerror(e=>{console.error(e)}),this.ws.ondisconnect(e=>{"disconnect"!=gui.opened&&gui.dialog("disconnect","reconnect"),this.ws.tryReconnect(1,()=>{this.request_auth(t,()=>{gui.$refs["dialog-disconnect"].onReconnect()})},()=>{gui.$refs["dialog-disconnect"].onFailed()},()=>{gui.$refs["dialog-disconnect"].onAttempt()})})):this.ws.request=c,e.debug&&(window.client=i)},request_auth:function({uid:e,token:t},n){const o=this.ws.request("Users:auth_token",{uid:e,token:t});null!=n&&o.then(n)}}},function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return r}));let o=null,s=null;function r(e){s=e}fetch("/js/items.json",{cache:"force-cache"}).then(e=>e.json()).then(e=>{o=e;for(let e in o)o[e].id=e})},function(e,t,n){"use strict";n.r(t),n.d(t,"init_app",(function(){return s})),n.d(t,"init_playtest",(function(){return r}));var o=n(1);function s(e,t,n){o.a.init_game_client(e.client,t,()=>{gui.$refs.matchmaking.open(t.wid||n)})}function r(e){gui.$refs.playtesting.open(e)}}])}));